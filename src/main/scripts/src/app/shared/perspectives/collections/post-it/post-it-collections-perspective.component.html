<div class="layout">

  <div *ngIf="editable" class="layout-item">
    <a class="add-collection" (click)="onNewCollection()">
      <i class="fa fa-plus-circle fa-5x"></i>
      <label>Add collection</label>
    </a>
  </div>

  <div *ngIf="editable" class="layout-item import"
       ondragover="return false;"
       [ngClass]="{'dragging': dragging}"
       (click)="fileInput.click()"
       (drop)="handleDrop($event)"
       (dragenter)="handleDragEnter()"
       (dragleave)="handleDragLeave()">
    <a class="add-collection">
      <i class="fa fa-cloud-upload fa-5x"></i>
      <label>Import collection</label>
    </a>
    <input type="file" #fileInput (click)="$event.stopPropagation()" (change)="fileChange($event.target.files)"
           accept=".csv, text/csv">
  </div>

  <div *ngFor="let collectionData of collectionDataObjects"
       class="post-it layout-item
       {{ lastClickedCollectionData === collectionData ? 'selected' : null}}
       {{ !collectionData.initialized.onServer ? 'uninitialized' : null }}"
       [style.border-color]="collectionData.collection.color"
       (click)="lastClickedCollectionData = collectionData">

    <ng-container
      *ngIf="collectionData.initialized.onServer; then initializedContent else nonInitializedContent"></ng-container>

    <ng-template #initializedContent>
      <div class="document-count clickable" title="Document count"
           [routerLink]="[workspacePath(), 'c', collectionData.collection.code, 'documents']">
        {{ collectionData.collection.documentsCount }}<i class="fa fa-file-text-o"></i>
      </div>

      <div class="content"
           [style.color]="collection.color"
           [routerLink]="[workspacePath(), 'c', collection.code, 'documents']">
        <i class="fa fa-2x {{ collection.icon }}" title="Go to documents"></i><!--
      --><input [(ngModel)]="collection.name" (ngModelChange)="updateCollection(collection)"/>
      <div class="content" [style.color]="collectionData.collection.color">
        <i class="fa fa-2x {{ collectionData.collection.icon }}" title="Go to documents"
           [routerLink]="[workspacePath(), 'c', collectionData.collection.code, 'documents']"></i><!--
      --><input [(ngModel)]="collectionData.collection.name"
                (ngModelChange)="updateCollection(collectionData)"/>
      </div>

      <icon-picker [enabled]="collectionData.pickerVisible"
                   [(color)]="collectionData.collection.color"
                   [(icon)]="collectionData.collection.icon"
                   (itemSelected)="updateCollection(collectionData)"></icon-picker>

      <div class="buttons">
        <a (click)="onDetailClick(collectionData.collection.code)" title="Detail">
          <i class="fa fa-fx fa-eye"></i></a>
        <a (click)="onAttributesClick(collectionData.collection.code)" title="Attributes">
          <i class="fa fa-fx fa-list-ul"></i></a>
        <a (click)="togglePicker(collectionData)" title="Icon picker" #iconSwitch>
          <i class="fa fa-fx fa-eyedropper"></i></a>
        <a *ngIf="hasManageRole(collectionData.collection)"
           (click)="onPermissionsClick(collectionData.collection.code)" title="Permissions">
          <i class="fa fa-fx fa-users"></i></a>
        <a *ngIf="hasManageRole(collectionData.collection)" (click)="onDeleteClick(collectionData)"
           title="Remove Collection">
          <i class="fa fa-fx fa-times remove-icon"></i></a>
      </div>
    </ng-template>

    <ng-template #nonInitializedContent>
      <div class="document-count" title="Document count">0<i class="fa fa-file-text-o"></i>
      </div>

      <div class="content" [style.color]="collectionData.collection.color">
        <i class="fa fa-2x {{ collectionData.collection.icon }}" title="Pick icon"
           (click)="togglePicker(collectionData)" #iconSwitch></i><!--
      --><input class="newName" placeholder="Name" #nonInitializedNameInput
                [(ngModel)]="collectionData.collection.name"
                (ngModelChange)="checkInitializedName(collectionData)"
                (blur)="checkInitialization(collectionData)"
                (keyup.enter)="checkInitialization(collectionData)"/>
      </div>

      <icon-picker class="onIcon"
                   [enabled]="collectionData.pickerVisible"
                   [(color)]="collectionData.collection.color"
                   [(icon)]="collectionData.collection.icon"
                   (itemSelected)="checkInitializedColor(collectionData); checkInitializedIcon(collectionData)"></icon-picker>

      <div class="buttons">
        <a (click)="onDeleteClick(collectionData)" title="Remove Collection">
          <i class="fa fa-fx fa-times remove-icon"></i></a>
      </div>
    </ng-template>
  </div>

  <label *ngIf="!editable && !query" class="label-centered">No Search Query</label>
  <label *ngIf="!editable && query && !collections.length" class="label-centered">Nothing To Show</label>
</div>
