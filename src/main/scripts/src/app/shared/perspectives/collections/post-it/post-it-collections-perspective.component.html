<div class="container-fluid">
  <div class="layout">

    <!-- collection post-its -->
    <div *ngFor="let postIt of postIts" #postItElement class="layout-item card post-it
           {{ postIt === lastClickedPostIt ? 'selected' : null }}
           {{ !postIt.initialized ? 'uninitialized' : null }}" [style.border-color]="postIt.collection.color">

      <div class="card-body text-center">
        <a class="icon" [style.color]="postIt.collection.color"
           title="{{ postIt.initialized ? 'Go to documents' : 'Pick icon' }}"
           [routerLink]="postIt.initialized ? [workspacePath(), 'c', postIt.collection.code, 'documents'] : []"
           data-toggle="dropdown"
           (click)="lastClickedPostIt = postIt">
          <i class="fa-6x {{ postIt.collection.icon }}" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <color-picker class="dropdown-item" [(color)]="postIt.collection.color"></color-picker>
          <div class="dropdown-divider"></div>
          <icon-picker class="dropdown-item" [(icon)]="postIt.collection.icon"></icon-picker>
        </div>

        <div *ngIf="postIt.initialized" class="float-right document-count">
          <a title="Document Count" [routerLink]="[workspacePath(), 'c', postIt.collection.code, 'documents']">
            {{ postIt.collection.documentsCount }}&nbsp;<i class="far fa-file" aria-hidden="true"></i>
          </a>
        </div>

        <div class="buttons d-flex flex-column" [style.top]="postIt.initialized ? '38px' : '5px'">
          <a *ngIf="postIt.initialized" (click)="onDetailClick(postIt.collection.code)" title="Detail"
             class="rounded-left text-success"><i class="fa fa-fw fa-search" aria-hidden="true"></i></a>
          <a *ngIf="postIt.initialized" (click)="onAttributesClick(postIt.collection.code)" title="Attributes"
             class="rounded-left text-success"><i class="fa fa-fw fa-list-ul" aria-hidden="true"></i></a>
          <a *ngIf="postIt.initialized" title="Icon picker" class="rounded-left text-success" data-toggle="dropdown"><i
            class="fa fa-fw fa-eye-dropper" aria-hidden="true"></i></a>
          <div class="dropdown-menu">
            <color-picker class="dropdown-item" [(color)]="postIt.collection.color"
                          (selectedChange)="updateCollection(postIt)"></color-picker>
            <div class="dropdown-divider"></div>
            <icon-picker class="dropdown-item" [(icon)]="postIt.collection.icon"
                         (selectedChange)="updateCollection(postIt)"></icon-picker>
          </div>
          <a *ngIf="postIt.initialized && hasManageRole(postIt.collection)"
             (click)="onPermissionsClick(postIt.collection.code)" title="Permissions"
             class="rounded-left text-success"><i class="fa fa-fw fa-users" aria-hidden="true"></i></a>
          <a *ngIf="!postIt.initialized || hasManageRole(postIt.collection)" (click)="confirmDeletion(postIt, modal)"
             class="text-danger rounded-left"
             title="Remove Collection"><i class="fa fa-fw fa-times" aria-hidden="true"></i></a>
        </div>

      </div>

      <textarea class="card-footer text-center font-weight-bold bg-transparent" #textArea rows="1" placeholder="Name" 
                    [(ngModel)]="postIt.collection.name"
                    (ngModelChange)="updateToScrollbarHeight(textArea)" (blur)="onTextAreaBlur(postIt, textArea)"
                    (focus)="textArea.placeholder = ''">
      </textarea>
    </div>

    <!-- add buttons -->
    <ng-container *ngIf="editable">
      <div class="layout-item card text-center add-post-it" (click)="newPostIt()">
        <div class="card-body">
          <i class="fa fa-plus-circle fa-6x" aria-hidden="true"></i>
        </div>
        <div class="card-footer font-weight-bold bg-transparent">Add collection</div>
      </div>

      <div class="layout-item card text-center add-post-it" ondragover="return false;" [ngClass]="{'dragging': dragging}" (click)="fileInput.click()"
        (drop)="handleDrop($event)" (dragenter)="handleDragEnter()" (dragleave)="handleDragLeave()">
        <div class="card-body">
          <i class="fa fa-cloud-upload fa-6x" aria-hidden="true"></i>
        </div>
        <div class="card-footer font-weight-bold bg-transparent">Import collection</div>
        <input hidden type="file" #fileInput (click)="$event.stopPropagation()"
               (change)="fileChange($event.target.files)"
               accept=".csv, text/csv">
      </div>
    </ng-container>
  </div>
</div>

<!-- modal -->
<ng-template #modal>
  <div class="modal-header bg-danger text-white rounded-top">
    <h5 class="modal-title">Delete Collection?</h5>
    <button type="button" class="close" aria-label="Close" (click)="deleteConfirm.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p>Deleting a collection will permanently remove it from this project. All documents stored inside the collection
      will be
      lost.
    </p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="deleteConfirm.hide()">No, Keep Collection</button>
    <button type="button" class="btn btn-danger" (click)="deleteConfirm.hide(); removeCollection(postItToDelete)">
      Yes, Delete Collection
    </button>
  </div>
</ng-template>
