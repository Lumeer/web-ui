<ul class="list-group mx-5">
  <li *ngFor="let linkType of linkTypes; let idx = index"
      class="list-group-item pt-2 color-transition {{ !initialized(linkType) ? 'uninitialized' : 'pb-0' }}"
      [style.border-color]="collection.color">
    <ng-container *ngIf="collections[linkType.toCollection]">
      <div class="d-flex align-baseline py-1">
          <span class="start">
            <i class="p-2 fa fa-caret-right bigger expand {{ expanded[idx] ? 'fa-rotate-90' : null}}"
               aria-hidden="true"
               title="Open"
               i18n-title="@@collection.config.tab.link.types.open"
               [style.visibility]="!initialized(linkType) ? 'hidden' : null"
               (click)="expanded[idx] = !expanded[idx]"></i>
            <i class="fa-fw {{ collection.icon }} first-collection bigger color-transition"
               title="{{ collection.name }}"
               [style.color]="collection.color"
               aria-hidden="true"></i>
            <i class="fa-fw {{ collections[linkType.toCollection].icon }} second-collection bigger"
               title="{{ initialized(linkType) ? collections[linkType.toCollection].name : 'Pick collection to link'}}"
               [style.color]="collections[linkType.toCollection].color"
               data-toggle="dropdown"
               aria-hidden="true"></i>
            <div class="dropdown-menu">
              <span *ngFor="let collectionCode of possibleToCollectionCodes(linkType)"
                    class="dropdown-item"
                    [style.color]="collections[collectionCode].color"
                    (click)="linkType.toCollection = collectionCode; updateLinkType(linkType, idx)">
                <i class="mr-1 fa-fw {{ collections[collectionCode].icon }}" aria-hidden="true"></i>
                {{ collections[collectionCode].name }}
              </span>
            </div>

            <input #name
                   class="ml-3 border-0 name"
                   placeholder="Link Type Name"
                   title="rename"
                   i18n-title="@@collection.config.tab.link.types.rename"
                   [(ngModel)]="linkType.name"
                   (keyup.enter)="name.blur()"
                   (blur)="linkType.name || linkType.toCollection === 'NO_COLLECTION_CODE' ?
                  updateLinkType(linkType, idx) : deleteLinkType(linkType, idx)">
            <span *ngIf="initialized(linkType)"
                  class="ml-3 pr-1 border-dark instance-count rounded border"
                  title="Instance count"
                  i18n-title="@@collection.config.tab.link.types.instance.count">
              {{ formatNumber(instanceCount(linkType)) }}
            </span>
          </span>

        <span *ngIf="initialized(linkType)">
            <a [routerLink]="[workspacePath(), 'search', 'links']"
               [queryParams]="searchLinkTypesQueryParams(linkType)"
               class="btn btn-outline-success mr-1"
               title="Show all searches of this attribute"
               i18n-title="@@collection.config.tab.link.types.show.all"
               i18n="@@collection.config.tab.link.types.show.all.text">
              See all
            </a>

            <a tabindex
               (click)="changeCollection(linkType.toCollection)"
               class="btn btn-outline-success {{ !initialized(linkType) ? 'disabled' : null }}"
               title="Go to {{ collections[linkType.toCollection].name }}"
               i18n-title="@@collection.config.tab.link.types.go.to">
              <i class="fa fa-arrow-right" aria-hidden="true"></i>
              <i class="fa-fw {{ collections[linkType.toCollection].icon }}" aria-hidden="true"></i>
            </a>
          </span>
      </div>
      <div *ngIf="initialized(linkType)"
           (click)="expanded[idx] = true">
        <div *ngIf="isAutomatic(linkType) || canBecomeAutomatic(linkType)"
             class="p-1 {{ canBecomeAutomatic(linkType) ? 'greyed-out' : null }}"
             (click)="canBecomeAutomatic(linkType) && makeAutomatic(linkType)">
          <span i18n="@@collection.config.link.types.automatic.link" class="font-weight-bold mr-1">
            {{ isAutomatic(linkType) ? 'Automatic Link:' : 'Make Automatic:' }}
          </span>
          <span>
            <i class="fa-fw {{ collection.icon }} color-transition"
               [style.color]="collection.color"></i>
            <span>{{ linkType.automaticLinkFromAttribute || (linkType.linkedAttributes.length === 2 && linkType.linkedAttributes[0].value.name) }}</span>
          </span>
          <i class="fa fa-arrows-h mx-1" aria-hidden="true"></i>
          <span>
            <i class="fa-fw {{ collections[linkType.toCollection].icon }}"
               [style.color]="collections[linkType.toCollection].color"></i>
            <span>{{ linkType.automaticLinkToAttribute || (linkType.linkedAttributes.length === 2 && linkType.linkedAttributes[1].value.name) }}</span>
          </span>
        </div>
        <link-attribute-list
          [collections]="collections"
          [linkType]="linkType"
          [addEnabled]="!linkType.automaticLinkFromAttribute || !linkType.automaticLinkToAttribute"
          [limit]="expanded[idx] ? 9999 : 1"></link-attribute-list>
      </div>
    </ng-container>
  </li>
  <li class="list-group-item py-3 new-link-type color-transition"
      [style.border-color]="collection.color"
      (click)="newLinkType()">
    <div class="d-flex align-baseline">
      <i class="fa fa-plus bigger" aria-hidden="true"></i>
      <span class="ml-3" i18n="@@collection.config.tab.link.types.add">
        Add link Type
      </span>
    </div>
  </li>
</ul>
