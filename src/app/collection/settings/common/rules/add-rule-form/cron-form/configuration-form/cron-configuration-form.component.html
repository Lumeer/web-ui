<div class="form-group text-muted small" i18n="@@collection.config.tab.rules.cron.info">
  An automation executed regularly according to the timer settings.
</div>

<div [formGroup]="configForm" class="config-form">

  <label i18n="@@collection.config.tab.rules.cron.timer.every">Repeat every</label>
  <div class="d-flex align-items-center flex-nowrap">
    <input class="form-control mr-2 interval-input" type="number"
           min="1" [max]="unitControl.value | maxIntervalByUnit" id="interval" formControlName="interval"
           integer minValue="1" [maxValue]="unitControl.value | maxIntervalByUnit"/>
    <select-item class="type-input" [items]="unitsItems"
                 [selectedId]="unitControl.value"
                 (selected)="onUnitSelect($event)">
    </select-item>
  </div>

  <ng-container *ngIf="unitControl.value | showDaysOfWeek">
    <label i18n="@@collection.config.tab.rules.cron.timer.repeat">Repeat on</label>
    <div class="d-flex align-items-center flex-wrap">
      <custom-checkbox *ngFor="let dayOfWeek of dayOfWeeks; let last = last"
                       [class.mr-3]="!last"
                       [checkboxTitle]="dayOfWeek.title"
                       [checkboxId]="dayOfWeek.id"
                       [title]="dayOfWeek.tooltip"
                       [checked]="daysOfWeekControl.value | isDayOfWeekSelected:dayOfWeek.bit"
                       (checkedChange)="onDayOfWeekChange(dayOfWeek, $event)">
      </custom-checkbox>
    </div>
  </ng-container>

  <ng-container *ngIf="unitControl.value | showOccurence">
    <label i18n="@@collection.config.tab.rules.cron.timer.run">Run on</label>
    <div class="d-flex align-items-center flex-nowrap">
      <input class="form-control hour-input mr-2" type="number"
             min="1" max="31" id="occurence" formControlName="occurence" integer minValue="1" maxValue="31"/>
      <span i18n="@@collection.config.tab.rules.cron.timer.dayInMonth">day in month</span>
    </div>
  </ng-container>

  <label i18n="@@collection.config.tab.rules.cron.timer.start">Start on</label>
  <date-time-input class="date-input"
                   id="startsOnDate"
                   [format]="dateFormat"
                   [value]="startsOnControl.value"
                   [asUtc]="true"
                   (valueChange)="startsOnControl.setValue($event)">
  </date-time-input>

  <label i18n="@@collection.config.tab.rules.cron.timer.execute">Execute at</label>
  <div class="d-flex align-items-center flex-nowrap">
    <input class="form-control hour-input mr-2" type="number"
           min="0" max="23" id="hour" formControlName="hour" integer minValue="0" maxValue="23"/>
    <span class="text-warning">
      <i class="fal fa-exclamation-triangle" i18n-tooltip="@@collection.config.tab.rules.cron.timer.delay" tooltip="The execution can be delayed up to several minutes depending on the server load."></i>
    </span>
  </div>

  <label class="align-self-start" i18n="@@collection.config.tab.rules.cron.timer.ends">Ends</label>
  <div class="ends-on-form">

    <input type="radio" name="never" id="never" value="never"
           (change)="onNeverChecked($event.target.checked)"
           [checked]="!(endsOnControl.value | isDateValid) && !(executionsControl.value > 0)">
    <label for="never" i18n="@@collection.config.tab.rules.cron.timer.never">Never</label>
    <div>&nbsp;</div>

    <input type="radio" name="date" id="date" value="date"
           (change)="onEndsOnChecked($event.target.checked)"
           [checked]="endsOnControl.value | isDateValid">
    <label for="date" i18n="@@collection.config.tab.rules.cron.timer.on">On</label>
    <date-time-input class="date-input"
                     id="endsOnDate"
                     [format]="dateFormat"
                     [value]="endsOnControl.value"
                     [asUtc]="true"
                     (valueChange)="onEndDateChange($event)">
    </date-time-input>

    <input type="radio" name="num" id="num" value="num"
           (change)="onExecutionsChecked($event.target.checked)"
           [checked]="executionsControl.value > 0">
    <label for="num" i18n="@@collection.config.tab.rules.cron.timer.after">After</label>
    <div class="d-flex align-items-center">
      <input class="form-control mr-2 interval-input" type="number"
             min="1" max="1000" id="executions"
             integer minValue="1" maxValue="1000" formControlName="executionsLeft"/>
      <span i18n="@@collection.config.tab.rules.cron.timer.executions">executions</span>
    </div>

  </div>

  <label class="align-self-start py-2" i18n="@@collection.config.tab.rules.cron.timer.view">View</label>
  <div>
    <select-item [items]="viewsByCollection$ | async | viewsSelectItems:(collections$ | async)"
                 class="w-100"
                 buttonClasses="w-100"
                 emptyValue="Select view"
                 i18n-emptyValue="@@projects.tab.template.metadata.defaultView.empty"
                 [removable]="true"
                 [selectedId]="viewControl.value"
                 [fitParent]="true"
                 (selected)="onSelectView($event)"
                 (remove)="onRemoveView()">
    </select-item>
    <div class="text-muted small mt-1" i18n="@@collection.config.tab.rules.cron.timer.records">Read records from this view and pass them to the automation. No records are passed when empty.</div>
  </div>

</div>
