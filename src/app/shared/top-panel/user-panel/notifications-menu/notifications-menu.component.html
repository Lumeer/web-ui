<div class="panel-item mx-2 notifications">
  <div class="dropdown show">
    <a href="#"
       role="button"
       id="notificationsDropdownLink"
       data-toggle="dropdown"
       data-offset="0,10"
       aria-haspopup="true"
       aria-expanded="false">

      <span class="fa-stack">
        <i class="fa fa-bell fa-stack-2x"
           [class.text-primary]="(unreadNotifications$ | async)?.length > 0"
           [class.text-secondary]="!(unreadNotifications$ | async) || (unreadNotifications$ | async).length === 0"
        ></i>
        <span class="fa-stack-1x" *ngIf="(unreadNotifications$ | async)?.length > 0">
          <span class="notifications-count">{{(unreadNotifications$ | async).length}}</span>
        </span>
      </span>
    </a>

    <div class="dropdown-menu dropdown-menu-right pre-scrollable"
         aria-labelledby="notificationsDropdownLink">

      <form class="px-2 text-right">
        <span class="small text-muted mr-1 align-text-top">Show only unread</span>
        <label class="switch">
          <input type="checkbox" [checked]="unreadOnly"  (click)="toggleUnreadFilter($event)">
          <span class="slider round" (click)="$event.stopPropagation()"></span>
        </label>
      </form>

      <a *ngFor="let notification of ((unreadOnly ? unreadNotifications$ : notifications$) | async);"
         class="dropdown-item cursor-default">
        <span class="notification-title clearfix">
          <span class="status small text-muted float-left">{{notification.createdAt | date:'shortDate' }}</span>
          <span class="status float-right"
                [class.read]="notification.read"
                [class.unread]="!notification.read">
            <span class="align-text-top small text-muted">
              <span *ngIf="!notification.firstReadAt" i18n="@@userNotifications.new">new</span>
              <span *ngIf="notification.read && notification.firstReadAt" i18n="@@userNotifications.readOn">read on</span>
              <span *ngIf="!notification.read && notification.firstReadAt" i18n="@@userNotifications.originallyReadOn">originally read on</span>
              <span *ngIf="notification.firstReadAt">{{' ' + (notification.firstReadAt | date:'shortDate')}}</span>
            </span>
            <i *ngIf="notification.read"
               (click)="setNotificationReadStatus($event, notification, false)"
               class="fa fa-eye text-success ml-1 cursor-pointer"
               title="Mark as unread"
               title.i18n="@@userNotifications.mark.unread"></i>
            <i *ngIf="!notification.read"
               (click)="setNotificationReadStatus($event, notification, true)"
               class="fa fa-eye-slash text-success ml-1 cursor-pointer"
               title="Mark as read"
               title.i18n="@@userNotifications.mark.read"></i>
          </span>
        </span>
        <span class="notification-content read text-notice cursor-pointer"
              [class.read]="notification.read"
              [class.text-notice]="notification.read"
              [class.unread]="!notification.read">
          <ng-container *ngTemplateOutlet="getTemplate(notification.type); context: { $implicit: notification }"></ng-container>
        </span>
      </a>

      <a *ngIf="!((unreadOnly ? unreadNotifications$ : notifications$) | async) || ((unreadOnly ? unreadNotifications$ : notifications$) | async).length === 0"
         class="dropdown-item cursor-default"
         i18n="@@userNotifications.empty">
        There are no notifications.
      </a>
    </div>
  </div>
</div>

<ng-template #organizationShared let-notification>
  <ng-container *ngIf="{organizations: organizations$ | async} as data">
    A new organization was shared with you. Click here to open it!
    <ng-container *ngIf="data.organizations[notification.organizationId] as organization;">
      <br/>
      <span class="d-inline-block pt-2">
        <span class="nowrap mr-1">
          <i [class]="organization.icon" class="mr-1" [style.color]="organization.color"></i>
          [{{organization.code}}]
        </span>
        {{organization.name}}
      </span>
    </ng-container>
  </ng-container>
</ng-template>

<ng-template #projectShared let-notification>
  project
</ng-template>

<ng-template #collectionShared let-notification>
  collection
</ng-template>

<ng-template #viewShared let-notification>
  view
</ng-template>

<ng-template #unknown let-notification>
  view
</ng-template>
