<div class="card post-it"
     [class.selected]="selected"
     [class.uninitialized]="!collection.id"
     [class.initialized]="collection.id">
  <div class="card-body text-center">
    <div *ngIf="!collection.id" id="{{newDropdownId}}">
      <a class="icon" [style.color]="collection.color"
         [title]="collection.name"
         [routerLink]="null"
         [queryParams]="null"
         [attr.data-toggle]="'dropdown'">
        <i class="fa-3x {{ collection.icon }}" aria-hidden="true" (click)="togglePanelVisible($event);"
           (clickOutside)="onPickerBlur()"></i>
      </a>
      <div class="dropdown-menu dropdown-menu-right uninitialized-dropdown">
        <color-picker [dropdownId]="newDropdownId"  class="dropdown-item" [(color)]="collection.color"></color-picker>
        <div class="dropdown-divider"></div>
        <icon-picker [dropdownId]="newDropdownId" class="dropdown-item"
                     [(icon)]="collection.icon"></icon-picker>
        <div class="dropdown-divider"></div>
        <div class="text-right mx-2">
          <button class="btn btn-outline-secondary btn-sm" data-toggle="dropdown" (click)="revertSelectedColor($event)" i18n="@@icon-picker.cancel">Cancel</button>
          <button class="btn btn-primary btn-sm mx-2" data-toggle="dropdown" (click)="saveSelectedColor($event)" i18n="@@icon-picker.select">Select</button>
        </div>
      </div>
    </div>

    <a *ngIf="collection.id" class="icon" [style.color]="collection.color"
       [title]="collection.name"
       [routerLink]="[workspacePath(), 'view', 'table']"
       [queryParams]="{ query: queryForCollectionDocuments() }">
      <i class="fa-3x {{ collection.icon }}" aria-hidden="true" (click)="togglePanelVisible($event);"
         (clickOutside)="onPickerBlur()"></i>
    </a>

    <div *ngIf="collection.id" class="document-count opacity-content clickable"
         [ngClass]="{'panel-visible' : focused}">
      <a title="Record Count" i18n-title="@@collection.document.count"
         [routerLink]="[workspacePath(), 'view', 'table']"
         [queryParams]="{ query: queryForCollectionDocuments() }">
        <i class="far fa-file" aria-hidden="true"></i>&nbsp;{{ collection.documentsCount }}
      </a>
    </div>

    <div *ngIf="collection.id" class="toggle-favorite opacity-content clickable clickable-warning"
         [ngClass]="{'panel-visible' : focused}"
         [class.always-visible]="collection.favorite">
      <a *ngIf="collection.favorite" title="Remove from favorites"
         i18n-title="@@collection.favorite.remove" (click)="toggleFavorite()">
        <i class="fas fa-star"
           aria-hidden="true"></i>
      </a>
      <a *ngIf="!collection.favorite" title="Add to favorites"
         i18n-title="@@collection.favorite.add" (click)="toggleFavorite()">
        <i class="far fa-star"
           aria-hidden="true"></i>
      </a>
    </div>

    <div class="buttons opacity-content d-flex flex-column"
         [ngClass]="{'panel-visible' : focused}">
      <div *ngIf="collection.id" id="dropdown-{{collection.id}}">
        <a title="Configure" i18n-title="@@collection.button.configure"
           class="rounded-left"
           *ngIf="hasManageRole()"
           [routerLink]="[workspacePath(), 'f', collection.id, 'attributes']">
          <i class="fas fa-fw fa-cog" aria-hidden="true"></i></a>
      </div>
    </div>

  </div>

  <small class="text-danger text-center px-2" *ngIf="!nameFormControl.valid"
       i18n="@@collection.postit.name.duplicity">
    Sorry, this name is already taken. Try another?
  </small>

  <post-it-collection-name
    [collectionName]="collection.name"
    [editable]="hasWriteRole() || !collection.id"
    [nameFormControl]="nameFormControl"
    (changed)="onNameChanged($event)"
    (selected)="onNameSelect()"
    (unselected)="onNameUnselect()">
  </post-it-collection-name>
</div>
