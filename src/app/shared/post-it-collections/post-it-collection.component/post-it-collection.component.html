<div class="card post-it"
     [class.selected]="selected"
     [class.uninitialized]="!collection.id"
     [class.initialized]="collection.id"
     [style.border-color]="collection.color">
  <div class="card-body text-center" id="dropdown-new-{{collection.correlationId}}">
    <a class="icon" [style.color]="collection.color"
       [title]="collection.name"
       [routerLink]="collection.id ? [workspacePath(), 'view', 'table'] : null"
       [queryParams]="collection.id ? { query: queryForCollectionDocuments() } : null"
       [attr.data-toggle]="collection.id ? '' : 'dropdown'">
      <i class="fa-6x {{ collection.icon }}" aria-hidden="true"></i>
    </a>
    <div *ngIf="!collection.id" class="dropdown-menu dropdown-menu-right uninitialized-dropdown">
      <color-picker class="dropdown-item" [(color)]="collection.color"></color-picker>
      <div class="dropdown-divider"></div>
      <icon-picker [dropdownId]="'dropdown-new-' + collection.correlationId" class="dropdown-item" [(icon)]="collection.icon"></icon-picker>
    </div>

    <div *ngIf="collection.id" class="document-count opacity-content clickable"
         [ngClass]="{'panel-visible' : focused}">
      <a title="Record Count" i18n-title="@@collection.document.count"
         [routerLink]="[workspacePath(), 'view', 'table']"
         [queryParams]="{ query: queryForCollectionDocuments() }">
        <i class="far fa-file" aria-hidden="true"></i>&nbsp;{{ collection.documentsCount }}
      </a>
    </div>

    <div *ngIf="collection.id" class="text-warning toggle-favorite opacity-content clickable"
         [ngClass]="{'panel-visible' : focused}"
         [class.always-visible]="collection.favorite">
      <a title="{{collection.favorite ?  'Remove from favorites' : 'Add to favorites'}}"
         i18n-title="@@collection.favorite" (click)="toggleFavorite()">
        <i class="fa-star" [ngClass]="collection.favorite ? 'fas' : 'far'"
           aria-hidden="true"></i>
      </a>
    </div>

    <div class="buttons opacity-content d-flex flex-column"
         [ngClass]="{'panel-visible' : focused}"
         [style.top]="'50px'">
      <div *ngIf="collection.id" id="dropdown-{{collection.id}}">
        <a title="Configure" i18n-title="@@collection.button.configure"
           class="rounded-left"
           *ngIf="hasManageRole()"
           [routerLink]="[workspacePath(), 'f', collection.id, 'attributes']">
          <i class="fas fa-fw fa-cog" aria-hidden="true"></i></a>

        <a title="Icon picker" i18n-title="@@collection.button.icon"
           class="rounded-left" data-toggle="dropdown">
          <i class="fas fa-fw fa-eye-dropper" aria-hidden="true" (click)="togglePanelVisible($event);"
             (clickOutside)="onPickerBlur()"></i></a>
        <div class="dropdown-menu dropdown-menu-right">
          <color-picker class="dropdown-item" [(color)]="collection.color"></color-picker>
          <div class="dropdown-divider"></div>
          <icon-picker [dropdownId]="'dropdown-' + collection.id" class="dropdown-item" [(icon)]="collection.icon"></icon-picker>
        </div>
      </div>

      <a *ngIf="!collection.id || hasManageRole()"
         (click)="onDelete()"
         class="text-danger rounded-left"
         title="Remove File" i18n-title="@@collection.button.remove">
        <i class="fas fa-fw fa-trash" aria-hidden="true"></i>
      </a>
    </div>

  </div>

  <div class="error text-center px-2" *ngIf="!nameFormControl.valid"
       i18n="@@collection.postit.name.duplicity">
    Sorry, this name is already taken. Try another?
  </div>

  <post-it-collection-name
    [collectionName]="collection.name"
    [editable]="hasWriteRole() || !collection.id"
    [nameFormControl]="nameFormControl"
    (changed)="onNameChanged($event)"
    (selected)="onNameSelect()"
    (unselected)="onNameUnselect()">
  </post-it-collection-name>
</div>
