<ng-container *ngIf="readonly; else textEditing">
  <ng-container *ngIf="{user: value | serializeDataValue | userByEmail : value?.constraintData?.users} as state">
    <img *ngIf="value | isDataValueValid"
         ngxGravatar
         [email]="value | serializeDataValue"
         [size]="avatarSize"
         class="ml-1">
    <input [readonly]="readonly"
           [title]="skipValidation ? name : (value | formatDataValue)"
           [value]="skipValidation ? name : (value | formatDataValue)"
           (focus)="onFocus.emit($event)"
           [class.invalid-value]="!skipValidation && (value?.config?.externalUsers ? !(value | isDataValueValid) : !state.user)"
           class="border-0 h-100 px-1 bg-transparent flex-grow-1 cursor-inherit"
           data-test="user-data-input"
           type="text">
  </ng-container>
</ng-container>

<ng-template #textEditing>
  <input #textInput
         [(ngModel)]="name"
         (blur)="onBlur()"
         (focus)="onFocused()"
         (ngModelChange)="onInputChange()"
         [spellcheck]="false"
         class="border-0 w-100 h-100 px-1 bg-transparent"
         data-test="user-data-input"
         type="text">

  <options-dropdown [options]="users | filterUsers:name"
                    [showBackdrop]="false"
                    [closeOnClickOutside]="false"
                    [origin]="textInput"
                    [firstItemActive]="!value?.config?.externalUsers && name?.length > 0"
                    (selectOption)="onSelectOption($event)">
  </options-dropdown>

</ng-template>
