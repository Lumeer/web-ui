<ng-container *ngIf="{selectedCursor: selectedCursor$ | async, documents: documents$ | async, linkInstances: linkInstances$ | async} as data">
  <ng-container *ngFor="let column of columns$ | async; trackBy: trackByAttributeIds; let columnIndex = index">
    <ng-container *ngIf="column | isSingleColumn; else emptyCell">
      <ng-container *ngIf="!((data.documents || data.linkInstances) | lengthGreaterThan:1); else collapsedCell">
        <ng-container *ngIf="{
          cursor: cursor | columnCursor:columnIndex,
          document: data.documents ? data.documents[0] : null,
          linkInstance: data.linkInstances ? data.linkInstances[0] : null,
          selected: data.selectedCursor | cursorEquals:(cursor | columnCursor:columnIndex)
        } as cell">
          <table-data-cell-suggestions *ngIf="cell.selected && !(cursor | isFirstPart) && !((cell.document | entityCreated) || (cell.linkInstance | entityCreated)) && editedValue"
                                       [column]="column"
                                       [cursor]="cell.cursor"
                                       [table]="table"
                                       [value]="editedValue"
                                       (linkCreate)="onLinkCreate(cell.cursor)">
          </table-data-cell-suggestions>

          <table-data-cell-menu *ngIf="cell.selected"
                                [cursor]="cell.cursor"
                                [document]="cell.document"
                                [linkInstance]="cell.linkInstance"
                                [table]="table"
                                (edit)="onEdit()">
          </table-data-cell-menu>

          <div tableDataCell
               [affected]="editedAttribute$ | async | affectedCell:(data.documents || data.linkInstances):column"
               [column]="column"
               [cursor]="cell.cursor"
               [document]="cell.document"
               [linkInstance]="cell.linkInstance"
               [table]="table"
               tableEditableCell
               [contextMenu]="dataCellMenu?.contextMenu"
               [readonly]="false"
               [selected]="cell.selected"
               [value]="(cell.document | extractValue:column) || (cell.linkInstance | extractValue:column) || ''"
               (valueChange)="onValueChange($event)"
               [class.transparent-border-top]="cursor | isFirstRow"
               [style.width]="column | columnWidth | pixel"
               (mousedown)="onMouseDown($event, columnIndex)"
               (moveCursor)="onMoveCursor($event)"
               class="table-border-right table-border-bottom data-input">
          </div>
        </ng-container>
      </ng-container>

      <ng-template #collapsedCell>
        <table-collapsed-cell [affected]="editedAttribute$ | async | affectedCell:(data.documents || data.linkInstances):column"
                              [column]="column"
                              [cursor]="cursor | columnCursor:columnIndex"
                              [documents]="data.documents"
                              [linkInstances]="data.linkInstances"
                              [selected]="data.selectedCursor | cursorEquals:(cursor | columnCursor:columnIndex)"
                              [style.width]="column | columnWidth | pixel"
                              [class.transparent-border-top]="cursor | isFirstRow"
                              (mousedown)="onMouseDown($event, columnIndex)"
                              class="d-block table-border-right table-border-bottom">
        </table-collapsed-cell>
      </ng-template>
    </ng-container>

    <ng-template #emptyCell>
      <div [style.width.px]="column | columnWidth"
           class="table-border-right table-border-bottom">
      </div>
    </ng-template>
  </ng-container>
</ng-container>
