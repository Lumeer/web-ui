<ng-container *ngIf="{selectedCursor: selectedCursor$ | async, documents: documents$ | async, linkInstances: linkInstances$ | async} as data">
  <ng-container *ngFor="let column of columns$ | async; trackBy: trackByAttributeIds; let columnIndex = index">
    <ng-container *ngIf="column | isSingleColumn; else emptyCell">
      <table-data-cell *ngIf="!((data.documents || data.linkInstances) | lengthGreaterThan:1); else collapsedCell"
                       [column]="column"
                       [cursor]="cursor | columnCursor:columnIndex"
                       [document]="data.documents ? data.documents[0] : null"
                       [linkInstance]="data.linkInstances ? data.linkInstances[0] : null"
                       [selected]="data.selectedCursor | cursorEquals:(cursor | columnCursor:columnIndex)"
                       [table]="table"
                       [class.transparent-border-top]="cursor | isFirstRow"
                       (mousedown)="onMouseDown($event, columnIndex)">
      </table-data-cell>

      <ng-template #collapsedCell>
        <table-collapsed-cell [column]="column"
                              [cursor]="cursor | columnCursor:columnIndex"
                              [documents]="data.documents"
                              [linkInstances]="data.linkInstances"
                              [selected]="data.selectedCursor | cursorEquals:(cursor | columnCursor:columnIndex)"
                              [style.width]="column | columnWidth | pixel"
                              [class.transparent-border-top]="cursor | isFirstRow"
                              (mousedown)="onMouseDown($event, columnIndex)"
                              class="d-block table-border-right table-border-bottom">
        </table-collapsed-cell>
      </ng-template>
    </ng-container>

    <ng-template #emptyCell>
      <div [style.width.px]="column | columnWidth"
           class="table-border-right table-border-bottom">
      </div>
    </ng-template>
  </ng-container>
</ng-container>
