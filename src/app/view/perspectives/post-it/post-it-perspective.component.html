<ng-container *ngIf="loaded$ | async">

  <ng-container *ngIf="{collections: collections$ | async, permissions: permissions$ | async, query: query$ | async} as data">

    <div *ngIf="documents.length; else noDocuments"
         class="container-fluid" infiniteScroll
         [infiniteScrollDistance]="2"
         (scrolled)="onScrollDown($event)">
      <div class="my-2 d-flex align-items-center">
        <add-document
          [disabled]="!(data.collections?.length === 1 && data.permissions[data.collections[0].id]?.writeWithView)"
          [collection]="data.collections[0]"
          [query]="query"
          (createPostIt)="createPostIt($event)">
        </add-document>

        <size-slider class="ml-auto"
                     [disabled]="!canManageConfig"
                     [defaultSize]="size$ | async"
                     (newSize)="onSizeChange($event)">
        </size-slider>
      </div>

      <div class="post-it-document-layout row" #postItLayout>

        <ng-container *ngIf="layout">

          <div class="layout-item {{size$ | async | postItColumnStyle}} mb-3"
               layout-item
               [layout]="layout"
               *ngFor="let doc of documents; trackBy:trackByDocument; let idx = index"
               [attr.key]="doc.id"
               id="{{perspectiveId}}#{{doc.correlationId || doc.id}}">
            <post-it-document
              *ngIf="{collection: doc | documentCollection:data.collections} as postItData"
              class="card post-it"
              [canManageConfig]="canManageConfig"
              [ngClass]="doc.id ? 'initialized': 'uninitialized'"
              [collection]="postItData.collection"
              [permissions]="data.permissions[postItData.collection?.id]"
              [query]="data.query"
              [index]="idx"
              [documentModel]="doc"
              [perspectiveId]="perspectiveId"
              [selectionHelper]="selectionHelper"
              (remove)="removePostIt(doc)"
              (sizeChange)="postItChanged(doc.correlationId || doc.id, $event)">
            </post-it-document>

          </div>

        </ng-container>

      </div>
    </div>

  </ng-container>

</ng-container>

<ng-template #noDocuments>
  <empty-post-its
    [query]="query"
    [collections]="collections$ | async"
    (createPostIt)="createPostIt($event)">
  </empty-post-its>
</ng-template>
