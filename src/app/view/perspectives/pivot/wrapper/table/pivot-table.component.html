<ng-container *ngIf="pivotTables$ | async as pivotTables">
  <ng-container *ngIf="pivotTables.length; else emptyCells">
    <table *ngFor="let pivotTable of pivotTables; let first"
           class="table table-bordered table-md"
           [class.mt-4]="!first">
      <tr *ngFor="let row of pivotTable.cells">

        <ng-container *ngFor="let cell of row">
          <td *ngIf="cell"
              class="cell {{cell.constraint ? (cell.constraint.type | lowercase) : ''}} text-truncate"
              [style.max-width.px]="150"
              [rowSpan]="cell.rowSpan"
              [colSpan]="cell.colSpan"
              [ngClass]="cell.cssClass"
              [style.background]="cell.background"
              [style.color]="cell.background && (cell.background | contrastColor)">
            <data-input-preview *ngIf="(cell | pivotTableCellHasValue) && cell.constraint"
                                [constraint]="cell.constraint"
                                [inline]="false"
                                [minWidth]="40"
                                [dataValue]="cell.value | dataValue:cell.constraint:constraintData">
            </data-input-preview>
            <div class="text-truncate" *ngIf="(cell | pivotTableCellHasValue) && !cell.constraint"
                 [innerHTML]="cell.value | stripHtml"
                 [title]="cell.value"></div>
            <ng-container *ngIf="!(cell | pivotTableCellHasValue)">&nbsp;</ng-container>
          </td>
        </ng-container>
      </tr>
    </table>
  </ng-container>
</ng-container>

<ng-template #emptyCells>
  <empty-state class="w-100"
               icon="far fa-empty-set">
    <h3 i18n="@@perspective.pivot.table.empty.title">Cannot display anything</h3>
    <div i18n="@@perspective.pivot.table.empty.description">Please configure your view in the sidebar on the left
      first.
    </div>
  </empty-state>
</ng-template>
